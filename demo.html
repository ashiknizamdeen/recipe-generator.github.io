<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartMix - Turn Leftovers into Delicious Meals</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        .recipe-card {
            transition: all 0.3s ease;
        }
        .recipe-card:hover {
            transform: translateY(-4px);
        }
        .ingredient-tag {
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f97316;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 via-white to-green-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Mock OpenAI API response generator (simulates API behavior)
        const generateRecipes = async (ingredients) => {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Sample recipes based on common ingredients
            const recipeDatabase = [
                {
                    title: "Leftover Rice Bowl",
                    description: "Customizable bowl using leftover rice as the base.",
                    usedIngredients: ["cooked rice", "broccoli", "avocado", "canned beans", "salsa"],
                    unusedIngredients: [],
                    cookingTime: "15 mins",
                    difficulty: "Easy",
                    servings: 2,
                    isVegetarian: true,
                    instructions: [
                        "Heat leftover rice in a pan with a splash of water",
                        "Steam or sauté broccoli until tender",
                        "Warm canned beans with spices",
                        "Assemble bowl with rice base, topped with beans, broccoli",
                        "Add sliced avocado and salsa to finish"
                    ],
                    substitutions: ["Rice can be replaced with quinoa", "Any vegetables work well"],
                    dietaryOptions: {
                        vegan: "Use plant-based protein instead of eggs if adding",
                        glutenFree: "Ensure all sauces are gluten-free certified"
                    }
                },
                {
                    title: "Pasta Primavera",
                    description: "All-in-one skillet pasta dish with fresh vegetables.",
                    usedIngredients: ["pasta", "chickpeas", "sauce", "cheese", "spinach"],
                    unusedIngredients: [],
                    cookingTime: "20 mins",
                    difficulty: "Easy",
                    servings: 4,
                    isVegetarian: true,
                    instructions: [
                        "Cook pasta according to package directions",
                        "Sauté chickpeas with garlic and olive oil",
                        "Add spinach and cook until wilted",
                        "Toss pasta with sauce and vegetables",
                        "Top with cheese and serve"
                    ],
                    substitutions: ["Any pasta shape works", "Can use any leafy greens"],
                    dietaryOptions: {
                        vegan: "Skip cheese or use nutritional yeast",
                        glutenFree: "Use gluten-free pasta"
                    }
                },
                {
                    title: "Burrito Wraps",
                    description: "Prepare your own wrap using leftover grains and fillings.",
                    usedIngredients: ["cooked rice", "canned beans", "broccoli", "vegetables", "salsa"],
                    unusedIngredients: [],
                    cookingTime: "15 mins",
                    difficulty: "Easy",
                    servings: 3,
                    isVegetarian: true,
                    instructions: [
                        "Warm tortillas in a dry pan",
                        "Heat rice and beans together with spices",
                        "Sauté vegetables until tender",
                        "Layer ingredients in tortilla",
                        "Roll tightly and serve with salsa"
                    ],
                    substitutions: ["Use any cooked grain", "Add any protein you have"],
                    dietaryOptions: {
                        vegan: "Skip dairy toppings",
                        glutenFree: "Use corn tortillas or lettuce wraps"
                    }
                },
                {
                    title: "Chicken Fried Rice",
                    description: "Classic way to use up cold rice, cooked meat and vegetables.",
                    usedIngredients: ["cooked rice", "chicken", "broccoli", "onions"],
                    unusedIngredients: [],
                    cookingTime: "15 mins",
                    difficulty: "Medium",
                    servings: 4,
                    isVegetarian: false,
                    instructions: [
                        "Heat oil in a large wok or pan",
                        "Scramble eggs and set aside",
                        "Stir-fry chicken until heated through",
                        "Add vegetables and cook until tender",
                        "Add cold rice, breaking up clumps",
                        "Season with soy sauce and combine with eggs"
                    ],
                    substitutions: ["Any protein works", "Use day-old rice for best results"],
                    dietaryOptions: {
                        vegetarian: "Replace chicken with tofu or extra eggs",
                        glutenFree: "Use tamari instead of soy sauce"
                    }
                },
                {
                    title: "Chicken Quesadillas",
                    description: "Easy-to-assemble meal that is perfect for a quick meal.",
                    usedIngredients: ["chicken", "canned beans", "cheese", "tortillas"],
                    unusedIngredients: [],
                    cookingTime: "10 mins",
                    difficulty: "Easy",
                    servings: 2,
                    isVegetarian: false,
                    instructions: [
                        "Shred or chop cooked chicken",
                        "Mash beans slightly for better binding",
                        "Layer cheese, chicken, and beans on half of tortilla",
                        "Fold and cook in pan until golden",
                        "Flip and cook other side until cheese melts"
                    ],
                    substitutions: ["Use any melting cheese", "Add any vegetables you have"],
                    dietaryOptions: {
                        vegetarian: "Skip chicken, add more beans and vegetables",
                        glutenFree: "Use corn tortillas"
                    }
                },
                {
                    title: "Chicken & Broccoli Skillet",
                    description: "Cheesy, one-pan dish that feels substantial and comforting.",
                    usedIngredients: ["chicken", "broccoli", "cheese", "onion"],
                    unusedIngredients: [],
                    cookingTime: "25 mins",
                    difficulty: "Medium",
                    servings: 4,
                    isVegetarian: false,
                    instructions: [
                        "Season and sear chicken pieces",
                        "Remove chicken, sauté onions",
                        "Add broccoli with a splash of broth",
                        "Return chicken to pan",
                        "Top with cheese and cover until melted"
                    ],
                    substitutions: ["Cauliflower works instead of broccoli", "Any cheese that melts well"],
                    dietaryOptions: {
                        lowCarb: "Serve as is without grains",
                        dairyFree: "Use nutritional yeast instead of cheese"
                    }
                },
                {
                    title: "Chicken and Veggie Tacos",
                    description: "Fresh meal that works well with tortillas and a variety of fillings.",
                    usedIngredients: ["chicken", "black beans", "broccoli", "tortillas"],
                    unusedIngredients: [],
                    cookingTime: "20 mins",
                    difficulty: "Easy",
                    servings: 4,
                    isVegetarian: false,
                    instructions: [
                        "Season and cook chicken with spices",
                        "Sauté vegetables until tender-crisp",
                        "Warm black beans with cumin",
                        "Warm tortillas",
                        "Assemble tacos with all components"
                    ],
                    substitutions: ["Use any vegetables", "Fish or tofu work as alternatives"],
                    dietaryOptions: {
                        vegetarian: "Replace chicken with seasoned chickpeas",
                        glutenFree: "Use corn tortillas or lettuce cups"
                    }
                }
            ];

            // Filter and match recipes based on ingredients
            const ingredientWords = ingredients.map(i => i.toLowerCase());
            
            let matchedRecipes = recipeDatabase.map(recipe => {
                const matchCount = recipe.usedIngredients.filter(ing => 
                    ingredientWords.some(word => ing.includes(word) || word.includes(ing))
                ).length;
                return { ...recipe, matchCount };
            })
            .filter(r => r.matchCount > 0)
            .sort((a, b) => b.matchCount - a.matchCount)
            .slice(0, 5);

            // If no matches, return generic versatile recipes
            if (matchedRecipes.length === 0) {
                matchedRecipes = recipeDatabase.slice(0, 3).map(recipe => ({
                    ...recipe,
                    usedIngredients: ingredients.slice(0, Math.min(3, ingredients.length)),
                    unusedIngredients: ingredients.slice(3)
                }));
            }

            return matchedRecipes;
        };

        // Ingredient suggestions for autocomplete
        const ingredientSuggestions = [
            "chicken", "beef", "pork", "fish", "tofu", "eggs",
            "rice", "pasta", "bread", "tortillas", "quinoa",
            "broccoli", "carrots", "spinach", "tomatoes", "onions", "garlic", "bell peppers",
            "cheese", "milk", "yogurt", "butter",
            "beans", "chickpeas", "lentils",
            "olive oil", "soy sauce", "salsa", "hot sauce"
        ];

        function SmartMixApp() {
            const [ingredients, setIngredients] = useState([]);
            const [inputValue, setInputValue] = useState("");
            const [recipes, setRecipes] = useState([]);
            const [loading, setLoading] = useState(false);
            const [expandedRecipe, setExpandedRecipe] = useState(null);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [filteredSuggestions, setFilteredSuggestions] = useState([]);
            const [savedRecipes, setSavedRecipes] = useState([]);
            const [apiKey, setApiKey] = useState("");
            const [showApiKeyModal, setShowApiKeyModal] = useState(false);
            const inputRef = useRef(null);

            useEffect(() => {
                if (inputValue.length > 0) {
                    const filtered = ingredientSuggestions.filter(
                        suggestion => 
                            suggestion.toLowerCase().includes(inputValue.toLowerCase()) &&
                            !ingredients.includes(suggestion)
                    );
                    setFilteredSuggestions(filtered);
                    setShowSuggestions(filtered.length > 0);
                } else {
                    setShowSuggestions(false);
                }
            }, [inputValue, ingredients]);

            const handleAddIngredient = (ingredient) => {
                if (ingredient && !ingredients.includes(ingredient)) {
                    setIngredients([...ingredients, ingredient]);
                    setInputValue("");
                    setShowSuggestions(false);
                    inputRef.current?.focus();
                }
            };

            const handleRemoveIngredient = (ingredient) => {
                setIngredients(ingredients.filter(i => i !== ingredient));
            };

            const handleGenerateRecipes = async () => {
                if (ingredients.length === 0) {
                    alert("Please add at least one ingredient!");
                    return;
                }

                setLoading(true);
                try {
                    const generatedRecipes = await generateRecipes(ingredients);
                    setRecipes(generatedRecipes);
                } catch (error) {
                    console.error("Error generating recipes:", error);
                    alert("Failed to generate recipes. Please try again.");
                } finally {
                    setLoading(false);
                }
            };

            const toggleSaveRecipe = (recipe) => {
                const isAlreadySaved = savedRecipes.some(r => r.title === recipe.title);
                if (isAlreadySaved) {
                    setSavedRecipes(savedRecipes.filter(r => r.title !== recipe.title));
                } else {
                    setSavedRecipes([...savedRecipes, recipe]);
                }
            };

            const isRecipeSaved = (recipe) => {
                return savedRecipes.some(r => r.title === recipe.title);
            };

            return (
                <div className="min-h-screen p-4 md:p-8">
                    {/* Header */}
                    <header className="glass-effect rounded-2xl shadow-lg p-6 mb-8 max-w-7xl mx-auto">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-3xl md:text-4xl font-bold text-gray-800">SmartMix</h1>
                                <p className="text-gray-600 mt-2">Turn your leftovers into delicious meals with AI</p>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="text-gray-700 font-medium">Welcome, Chef</span>
                                <div className="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-500 rounded-full flex items-center justify-center text-white font-bold">
                                    👨‍🍳
                                </div>
                            </div>
                        </div>

                        {/* Ingredient Input Section */}
                        <div className="space-y-4">
                            <div className="relative">
                                <input
                                    ref={inputRef}
                                    type="text"
                                    value={inputValue}
                                    onChange={(e) => setInputValue(e.target.value)}
                                    onKeyPress={(e) => {
                                        if (e.key === 'Enter') {
                                            handleAddIngredient(inputValue);
                                        }
                                    }}
                                    placeholder="e.g. chicken, tomatoes, onion, salad..."
                                    className="w-full p-4 pr-12 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-orange-400 text-gray-700"
                                />
                                <button
                                    onClick={() => handleAddIngredient(inputValue)}
                                    className="absolute right-2 top-1/2 transform -translate-y-1/2 p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                                >
                                    <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                    </svg>
                                </button>

                                {/* Autocomplete Suggestions */}
                                {showSuggestions && (
                                    <div className="absolute z-10 w-full mt-2 bg-white rounded-xl shadow-lg border border-gray-200 max-h-48 overflow-y-auto">
                                        {filteredSuggestions.map((suggestion, index) => (
                                            <button
                                                key={index}
                                                onClick={() => handleAddIngredient(suggestion)}
                                                className="w-full text-left px-4 py-2 hover:bg-orange-50 transition-colors text-gray-700"
                                            >
                                                {suggestion}
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* Ingredient Tags */}
                            <div className="flex flex-wrap gap-2">
                                {ingredients.map((ingredient, index) => (
                                    <span
                                        key={index}
                                        className="ingredient-tag inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-green-100 to-green-50 text-green-700 rounded-full text-sm font-medium border border-green-200"
                                    >
                                        {ingredient}
                                        <button
                                            onClick={() => handleRemoveIngredient(ingredient)}
                                            className="hover:text-red-600 transition-colors"
                                        >
                                            ✕
                                        </button>
                                    </span>
                                ))}
                            </div>

                            {/* Generate Button */}
                            <button
                                onClick={handleGenerateRecipes}
                                disabled={loading || ingredients.length === 0}
                                className="w-full md:w-auto px-8 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                            >
                                {loading ? (
                                    <span className="flex items-center justify-center gap-2">
                                        <div className="loading-spinner w-5 h-5 border-2"></div>
                                        Generating Recipes...
                                    </span>
                                ) : (
                                    "Generate Smart Recipes 🍳"
                                )}
                            </button>
                        </div>
                    </header>

                    {/* Recipe Cards Grid */}
                    {recipes.length > 0 && (
                        <div className="max-w-7xl mx-auto">
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">
                                    Your recipes are ready! Vegetarian recipes are labelled with 🥬
                                </h2>
                                {savedRecipes.length > 0 && (
                                    <span className="text-sm text-gray-600">
                                        {savedRecipes.length} recipe{savedRecipes.length !== 1 ? 's' : ''} saved
                                    </span>
                                )}
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {recipes.map((recipe, index) => (
                                    <div
                                        key={index}
                                        className="recipe-card glass-effect rounded-2xl shadow-lg overflow-hidden border border-gray-100"
                                    >
                                        <div className="p-6">
                                            <div className="flex justify-between items-start mb-3">
                                                <h3 className="text-xl font-semibold text-gray-800 flex items-center gap-2">
                                                    {recipe.title}
                                                    {recipe.isVegetarian && <span title="Vegetarian">🥬</span>}
                                                </h3>
                                                <button
                                                    onClick={() => toggleSaveRecipe(recipe)}
                                                    className={`transition-colors ${
                                                        isRecipeSaved(recipe) 
                                                            ? 'text-red-500 hover:text-red-600' 
                                                            : 'text-gray-400 hover:text-red-500'
                                                    }`}
                                                >
                                                    <svg className="w-6 h-6" fill={isRecipeSaved(recipe) ? "currentColor" : "none"} stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                                    </svg>
                                                </button>
                                            </div>
                                            
                                            <p className="text-gray-600 text-sm mb-4">{recipe.description}</p>
                                            
                                            <div className="flex flex-wrap gap-2 mb-4">
                                                {recipe.usedIngredients.slice(0, 4).map((ing, i) => (
                                                    <span key={i} className="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                                        {ing}
                                                    </span>
                                                ))}
                                                {recipe.usedIngredients.length > 4 && (
                                                    <span className="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                                        +{recipe.usedIngredients.length - 4} more
                                                    </span>
                                                )}
                                            </div>

                                            <div className="flex justify-between items-center text-sm text-gray-500 mb-4">
                                                <span>⏱️ {recipe.cookingTime}</span>
                                                <span>👥 {recipe.servings} servings</span>
                                                <span>📊 {recipe.difficulty}</span>
                                            </div>

                                            <button
                                                onClick={() => setExpandedRecipe(expandedRecipe === index ? null : index)}
                                                className="w-full py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-medium rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all"
                                            >
                                                {expandedRecipe === index ? "Hide Instructions" : "See Cooking Instructions"}
                                            </button>

                                            {/* Expanded Recipe Details */}
                                            {expandedRecipe === index && (
                                                <div className="mt-4 pt-4 border-t border-gray-200 space-y-4 animate-slideIn">
                                                    <div>
                                                        <h4 className="font-semibold text-gray-800 mb-2">Instructions:</h4>
                                                        <ol className="space-y-2">
                                                            {recipe.instructions.map((step, i) => (
                                                                <li key={i} className="text-sm text-gray-600 flex gap-2">
                                                                    <span className="font-semibold text-orange-500">{i + 1}.</span>
                                                                    <span>{step}</span>
                                                                </li>
                                                            ))}
                                                        </ol>
                                                    </div>

                                                    <div>
                                                        <h4 className="font-semibold text-gray-800 mb-2">Substitutions:</h4>
                                                        <ul className="space-y-1">
                                                            {recipe.substitutions.map((sub, i) => (
                                                                <li key={i} className="text-sm text-gray-600">• {sub}</li>
                                                            ))}
                                                        </ul>
                                                    </div>

                                                    <div>
                                                        <h4 className="font-semibold text-gray-800 mb-2">Dietary Options:</h4>
                                                        <div className="space-y-1">
                                                            {Object.entries(recipe.dietaryOptions).map(([diet, option]) => (
                                                                <div key={diet} className="text-sm">
                                                                    <span className="font-medium text-gray-700 capitalize">{diet}:</span>
                                                                    <span className="text-gray-600 ml-2">{option}</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Empty State */}
                    {!loading && recipes.length === 0 && (
                        <div className="max-w-2xl mx-auto text-center py-12">
                            <div className="text-6xl mb-4">🍽️</div>
                            <h3 className="text-xl font-semibold text-gray-700 mb-2">
                                Ready to reduce food waste?
                            </h3>
                            <p className="text-gray-600">
                                Add your leftover ingredients above and let AI suggest delicious recipes that minimize waste!
                            </p>
                        </div>
                    )}

                    {/* Footer Info */}
                    <footer className="max-w-7xl mx-auto mt-12 text-center text-sm text-gray-500">
                        <p>AI can make mistakes. Check for important information.</p>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<SmartMixApp />, document.getElementById('root'));
    </script>
</body>
</html>